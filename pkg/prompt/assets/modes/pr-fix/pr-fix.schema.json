{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://holon.dev/schemas/pr-fix-v1.json",
  "title": "PR Fix Output",
  "description": "Schema for pr-fix mode output. Contains structured responses to GitHub PR review comments and CI/check run status updates.",
  "type": "object",
  "anyOf": [
    {"required": ["review_replies"]},
    {"required": ["checks"]}
  ],
  "properties": {
    "review_replies": {
      "type": "array",
      "description": "Array of reply objects for review thread comments. Each reply addresses a specific review comment.",
      "items": {
        "type": "object",
        "required": ["comment_id", "status", "message"],
        "properties": {
          "comment_id": {
            "oneOf": [
              {"type": "integer"},
              {"type": "string"}
            ],
            "description": "Unique identifier for the review comment to reply to (GitHub comment ID). Prefer an integer (as returned by GitHub APIs); a string is allowed for compatibility with clients that serialize IDs as strings."
          },
          "status": {
            "type": "string",
            "enum": ["fixed", "wontfix", "need-info", "deferred"],
            "description": "Status of the fix for this review comment. 'deferred' indicates the request is valid but non-blocking, and will be addressed in a follow-up issue."
          },
          "message": {
            "type": "string",
            "description": "The response message to the reviewer explaining what was done or why."
          },
          "action_taken": {
            "type": ["string", "null"],
            "description": "Description of any code changes made to address the review comment. Null if no changes were made."
          }
        },
        "additionalProperties": false
      }
    },
    "follow_up_issues": {
      "type": "array",
      "description": "Array of follow-up issue drafts for deferred work. Each entry represents a GitHub issue to be created for tracking non-blocking requests.",
      "items": {
        "type": "object",
        "required": ["title", "body", "deferred_comment_ids"],
        "properties": {
          "title": {
            "type": "string",
            "description": "Title of the follow-up issue."
          },
          "body": {
            "type": "string",
            "description": "Body/content of the follow-up issue in Markdown format. Should include context, rationale, and suggested approach."
          },
          "deferred_comment_ids": {
            "type": "array",
            "description": "Array of comment IDs that this follow-up issue addresses. Links the deferred review comments to the issue.",
            "items": {
              "type": "integer"
            }
          },
          "labels": {
            "type": "array",
            "description": "Suggested labels for the follow-up issue (optional).",
            "items": {
              "type": "string"
            }
          },
          "issue_url": {
            "type": "string",
            "description": "URL of the created issue (optional). If the agent successfully created a GitHub issue, populate this with the URL. If creation failed (e.g., due to token permissions), leave this empty and the publisher will attempt to create it."
          }
        },
        "additionalProperties": false
      }
    },
    "checks": {
      "type": "array",
      "description": "Array of check run status updates. Each entry describes the fix status for a CI/check run.",
      "items": {
        "type": "object",
        "required": ["name", "conclusion", "fix_status", "message"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Name of the check run (e.g., 'ci/test', 'lint', 'security-scan')."
          },
          "conclusion": {
            "type": "string",
            "enum": ["failure", "success", "cancelled"],
            "description": "The original conclusion of the check run."
          },
          "fix_status": {
            "type": "string",
            "enum": ["fixed", "unfixed", "unverified", "not-applicable"],
            "description": "Status of the fix attempt for this check run. Use \"unverified\" when changes were made but verification could not be completed."
          },
          "message": {
            "type": "string",
            "description": "Explanation of what was fixed, what remains, or why the fix is not applicable."
          }
        },
        "additionalProperties": false
      }
    }
  },
  "additionalProperties": false
}
