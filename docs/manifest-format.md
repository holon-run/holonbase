# Holon Manifest Format

## Overview

The `manifest.json` file is generated by Holon agents at the end of each execution. It serves as the standardized output contract between the agent (TypeScript) and the runner (Go), containing execution status, artifacts, and metadata.

**Location:** `/holon/output/manifest.json`

## Purpose

- **Execution Record:** Documents the outcome and duration of task execution
- **Artifact Manifest:** Lists all generated output files (diffs, summaries, logs, etc.)
- **Agent Metadata:** Captures agent version, mode, and engine information for debugging and reproducibility
- **Type Safety Contract:** Ensures Go runner can parse TypeScript-generated outputs without type drift

## Schema

The canonical JSON Schema is maintained at [`schemas/manifest.schema.json`](../schemas/manifest.schema.json).

### Structure

```json
{
  "status": "completed",
  "outcome": "success",
  "duration": "12.5s",
  "artifacts": ["diff.patch", "summary.md", "evidence/"],
  "metadata": {
    "agent": "agent-claude",
    "version": "v0.7.0",
    "mode": "solve",
    "engine": {
      "model": "claude-sonnet-4-5-20250929",
      "version": "20250929"
    }
  }
}
```

### Field Reference

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `status` | string | Yes | Execution status: `"completed"`, `"failed"`, or `"running"` |
| `outcome` | string | Yes | Final outcome: `"success"`, `"failure"`, or `"needs_human"` |
| `duration` | string/number | Yes | Execution duration (e.g., `"12.5s"` or `12.5` for backward compatibility) |
| `artifacts` | array | Yes | List of output artifact paths (string array or object array) |
| `metadata` | object | No | Additional execution metadata (see below) |
| `error` | string | No | Error message (only present when outcome is `"failure"`) |

### Metadata Fields

| Field | Type | Description |
|-------|------|-------------|
| `agent` | string | Agent identifier (e.g., `"agent-claude"`, `"agent-claude-prfix"`) |
| `version` | string | Agent version (e.g., `"v0.7.0"`) |
| `mode` | string | Execution mode (e.g., `"solve"`, `"pr-fix"`, `"probe"`) |
| `engine` | object | Claude engine information (optional, added in v0.7.0) |

### Engine Object

| Field | Type | Description |
|-------|------|-------------|
| `model` | string | Model identifier (e.g., `"claude-sonnet-4-5-20250929"`) |
| `version` | string | Engine version (e.g., `"20250929"`) |

## Backward Compatibility

The manifest format maintains backward compatibility with previous agent bundle versions:

### Duration Format (v0.6.0+)
- **Current:** String format with `"s"` suffix (e.g., `"12.5s"`)
- **Legacy:** Number format (e.g., `12.5`) - automatically normalized to string

### Artifacts Array (v0.6.0+)
- **Current:** String array (e.g., `["diff.patch", "summary.md"]`)
- **Legacy:** Object array (e.g., `[{"name": "diff.patch", "path": "diff.patch"}]`) - automatically normalized to string array

### Engine Metadata (v0.7.0+)
- **v0.7.0+:** Includes nested `engine` object with model information
- **v0.6.x:** Does not include `engine` field (field is optional)

## Examples

### Successful Execution (solve mode)
```json
{
  "status": "completed",
  "outcome": "success",
  "duration": "12.5s",
  "artifacts": ["diff.patch", "summary.md", "evidence/"],
  "metadata": {
    "agent": "agent-claude",
    "version": "v0.7.0",
    "mode": "solve",
    "engine": {
      "model": "claude-sonnet-4-5-20250929",
      "version": "20250929"
    }
  }
}
```

### Failed Execution
```json
{
  "status": "completed",
  "outcome": "failure",
  "duration": "3.2s",
  "artifacts": ["evidence/"],
  "metadata": {
    "agent": "agent-claude",
    "version": "v0.7.0",
    "mode": "solve"
  }
}
```

### PR-Fix Mode
```json
{
  "status": "completed",
  "outcome": "success",
  "duration": "15.7s",
  "artifacts": ["pr-fix.json", "summary.md", "evidence/"],
  "metadata": {
    "agent": "agent-claude-prfix",
    "version": "v0.7.0",
    "mode": "pr-fix",
    "engine": {
      "model": "claude-sonnet-4-5-20250929",
      "version": "20250929"
    }
  }
}
```

### Probe Mode
```json
{
  "status": "completed",
  "outcome": "success",
  "duration": "0s",
  "artifacts": [{"name": "manifest.json", "path": "manifest.json"}],
  "metadata": {
    "mode": "probe"
  }
}
```

## Schema-First Design

To prevent type drift between TypeScript (agent) and Go (runner), the manifest format follows a **Schema-First** approach:

1. **Single Source of Truth:** [`schemas/manifest.schema.json`](../schemas/manifest.schema.json) defines the canonical format
2. **Contract Tests:** Go tests validate backward compatibility with all historical formats
3. **Future:** Automated type generation from JSON Schema (see [Issue #417](https://github.com/holon-run/holon/issues/417))

## Validation

### Go Contract Tests
Run contract tests to validate backward compatibility:
```bash
go test ./pkg/api/v1/... -v -run TestHolonManifest
```

### JSON Schema Validation
Validate manifest files against the schema using `ajv`:
```bash
npx ajv validate \
  -s schemas/manifest.schema.json \
  -d path/to/manifest.json
```

## Type Definitions

### Go (Runner)
```go
type HolonManifest struct {
    Status    string                 `json:"status"`
    Outcome   string                 `json:"outcome"`
    Duration  Duration               `json:"duration"`
    Artifacts Artifacts              `json:"artifacts"`
    Metadata  map[string]interface{} `json:"metadata,omitempty"`
}
```
Location: [`pkg/api/v1/spec.go`](../pkg/api/v1/spec.go)

### TypeScript (Agent)
The agent generates manifest objects directly (see [`agents/claude/src/agent.ts`](../agents/claude/src/agent.ts)).

## Evolution Policy

- **Minor versions (v0.x.0):** New optional fields may be added (e.g., `engine` in v0.7.0)
- **Patch versions (v0.7.x):** No breaking changes to existing fields
- **Major versions (v1.0.0):** Reserved for significant format changes with migration path

## Related Documentation

- [Schema-First Design Proposal](https://github.com/holon-run/holon/issues/417)
- [Type Drift Bug Report](https://github.com/holon-run/holon/issues/415)
- [PR #408: Agent Metadata Enhancement](https://github.com/holon-run/holon/pull/408)
